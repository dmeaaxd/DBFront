<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Страница авторизации</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
<h2>Авторизация</h2>
<form id="loginForm">
    <label for="username"></label>
    <input type="text" id="username" name="username" placeholder="Логин" required>
    <br>
    <label for="password"></label>
    <input type="password" id="password" name="password" placeholder="Пароль" required>
    <br>
    <input type="submit" value="Войти">
    <br>
</form>
<a href="register.html">
    <input type="submit" value="Регистрация">
</a>

<div id="error" style="display: none; color: red;"></div>

<script>
    document.getElementById('loginForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        // Отправка GraphQL-запроса на сервер
        axios.post('http://127.0.0.1:8000/users/graphql', {
            query: `
            mutation {
                tokenAuth(username: "${username}", password: "${password}") {
                    success
                    token
                }
            }
        `
        })
            .then(function (response) {
                const data = response.data.data.tokenAuth;
                if (data.success) {
                    // Получаем токен
                    const token = data.token;

                    sessionStorage.setItem('token', token);


                    // Перенаправляем пользователя на страницу index.html с токеном в URL
                    // window.location.href = `../index.html?token=${token}`;
                    window.location.href = `../index.html`;
                } else {
                    // Ошибка авторизации, отобразите сообщение об ошибке
                    document.getElementById('error').textContent = 'Ошибка';
                    document.getElementById('error').style.display = 'block';
                }
            })
            .catch(function (error) {
                console.error(error);
            });
    });


</script>
</body>
</html>
